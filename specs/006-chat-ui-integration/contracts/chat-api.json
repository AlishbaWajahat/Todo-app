{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Chat API Contract",
  "description": "API contract for the stateless agent chat endpoint",
  "version": "1.0.0",
  "baseUrl": "/api/v1",
  "endpoints": [
    {
      "path": "/agent/chat",
      "method": "POST",
      "summary": "Send message to stateless agent",
      "description": "Processes natural language message and returns agent response. Agent uses MCP tools to perform task operations.",
      "authentication": {
        "type": "Bearer",
        "required": true,
        "description": "JWT token in Authorization header"
      },
      "request": {
        "contentType": "application/json",
        "headers": {
          "Authorization": {
            "type": "string",
            "required": true,
            "pattern": "^Bearer [A-Za-z0-9-_=]+\\.[A-Za-z0-9-_=]+\\.[A-Za-z0-9-_.+/=]*$",
            "description": "JWT token for authentication",
            "example": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
          },
          "Content-Type": {
            "type": "string",
            "required": true,
            "enum": ["application/json"],
            "description": "Request content type"
          }
        },
        "body": {
          "type": "object",
          "required": ["user_id", "message"],
          "properties": {
            "user_id": {
              "type": "string",
              "minLength": 1,
              "description": "Authenticated user identifier (extracted from JWT)",
              "example": "user-123"
            },
            "message": {
              "type": "string",
              "minLength": 1,
              "maxLength": 1000,
              "description": "Natural language message from user",
              "example": "Create a task to buy groceries"
            }
          }
        }
      },
      "responses": {
        "200": {
          "description": "Successful response from agent",
          "contentType": "application/json",
          "body": {
            "type": "object",
            "required": ["response"],
            "properties": {
              "response": {
                "type": "string",
                "description": "Agent's natural language response",
                "example": "Task created: buy groceries"
              },
              "metadata": {
                "type": "object",
                "description": "Optional execution metadata",
                "properties": {
                  "intent": {
                    "type": "string",
                    "enum": ["CREATE", "LIST", "COMPLETE", "UPDATE", "DELETE", "UNKNOWN"],
                    "description": "Classified intent",
                    "example": "CREATE"
                  },
                  "tool_called": {
                    "type": ["string", "null"],
                    "enum": ["add_task", "list_tasks", "complete_task", "update_task", "delete_task", null],
                    "description": "MCP tool that was invoked",
                    "example": "add_task"
                  },
                  "confidence": {
                    "type": "number",
                    "minimum": 0,
                    "maximum": 1,
                    "description": "Intent classification confidence",
                    "example": 0.95
                  },
                  "execution_time_ms": {
                    "type": "integer",
                    "minimum": 1,
                    "description": "Request execution time in milliseconds",
                    "example": 234
                  }
                }
              }
            }
          },
          "examples": [
            {
              "name": "Create task success",
              "value": {
                "response": "Task created: buy groceries",
                "metadata": {
                  "intent": "CREATE",
                  "tool_called": "add_task",
                  "confidence": 0.95,
                  "execution_time_ms": 234
                }
              }
            },
            {
              "name": "List tasks success",
              "value": {
                "response": "You have 3 tasks: 1) Buy milk 2) Call dentist 3) Finish report",
                "metadata": {
                  "intent": "LIST",
                  "tool_called": "list_tasks",
                  "confidence": 0.98,
                  "execution_time_ms": 156
                }
              }
            },
            {
              "name": "Unknown intent",
              "value": {
                "response": "I can only help with task management. Try 'create a task' or 'show my tasks'.",
                "metadata": {
                  "intent": "UNKNOWN",
                  "tool_called": null,
                  "confidence": 0.45,
                  "execution_time_ms": 12
                }
              }
            }
          ]
        },
        "400": {
          "description": "Validation error",
          "contentType": "application/json",
          "body": {
            "type": "object",
            "required": ["detail", "code"],
            "properties": {
              "detail": {
                "type": "string",
                "description": "Human-readable error message",
                "example": "Message must be between 1 and 1000 characters"
              },
              "code": {
                "type": "string",
                "enum": ["VALIDATION_ERROR"],
                "description": "Machine-readable error code",
                "example": "VALIDATION_ERROR"
              }
            }
          }
        },
        "401": {
          "description": "Authentication failed",
          "contentType": "application/json",
          "body": {
            "type": "object",
            "required": ["detail", "code"],
            "properties": {
              "detail": {
                "type": "string",
                "description": "Human-readable error message",
                "example": "Invalid or expired token"
              },
              "code": {
                "type": "string",
                "enum": ["INVALID_TOKEN", "EXPIRED_TOKEN", "MISSING_TOKEN"],
                "description": "Machine-readable error code",
                "example": "EXPIRED_TOKEN"
              }
            }
          }
        },
        "500": {
          "description": "Server error",
          "contentType": "application/json",
          "body": {
            "type": "object",
            "required": ["detail", "code"],
            "properties": {
              "detail": {
                "type": "string",
                "description": "Generic error message (no internal details)",
                "example": "Something went wrong. Please try again."
              },
              "code": {
                "type": "string",
                "enum": ["INTERNAL_ERROR"],
                "description": "Machine-readable error code",
                "example": "INTERNAL_ERROR"
              }
            }
          }
        }
      },
      "performance": {
        "p95_latency_ms": 2000,
        "timeout_ms": 30000,
        "description": "95% of requests should complete within 2 seconds. Requests timeout after 30 seconds."
      },
      "security": {
        "authentication": "JWT token required in Authorization header",
        "authorization": "User can only access their own tasks (enforced by agent and MCP tools)",
        "input_validation": "Message length validated (1-1000 chars)",
        "output_sanitization": "Agent responses are plain text (no HTML)"
      },
      "notes": [
        "Agent is stateless - no conversation history maintained on backend",
        "Each request is independent and self-contained",
        "DELETE operation has known 80% success rate (parameter extraction limitation)",
        "Agent uses MCP tools which enforce user_id isolation",
        "No streaming responses - single response per request"
      ]
    }
  ]
}
